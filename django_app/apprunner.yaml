version: 1.0
runtime: python311
build:
  commands:
    build:
      # - curl -o apk-tools-static-2.14.4-r0.apk https://pkgs.alpinelinux.org/package/edge/main/x86_64/apk-tools-static
      # - tar -zxvf apk-tools-static-2.14.4-r0.apk
      # - cd sbin
      # - ./apk.static -X http://dl-cdn.alpinelinux.org/alpine/latest-stable/main -U --allow-untrusted --initdb add apk-tools-static
      # - apk.static update
      # - ./apk.static -X http://dl-cdn.alpinelinux.org/alpine/latest-stable/main -U --allow-untrusted add apk-tools
      # - apk update
      # - apk add pkg-config=0.29.2
      # - yum install pkg-config -y
      # - apk add libmysqlclient-dev
      - yum update -y
      - yum install pkg-config -y
      # rpm -Uvh https://repo.mysql.com/mysql80-community-release-el9-5.noarch.rpm
      # yum install mysql80-community-release-el9-5.noarch.rpm -y
      - yum install wget -y
      - wget https://dev.mysql.com/get/mysql80-community-release-el9-5.noarch.rpm
      - yum install mysql80-community-release-el9-5.noarch.rpm -y
      - yum install yum-utils
      - yum-config-manager --disable mysql57-community
      - yum-config-manager --enable mysql80-community
      # - yum repolist enabled
      - yum install mysql -y
      - pip3 install -r requirements.txt
  env:
    - name: DJANGO_SETTINGS_MODULE
      value: "datalake_from_scratch.settings"
run:
  runtime-version: 3.11
  pre-run:
    - pip3 install -r requirements.txt
    - python3 manage.py makemigrations
    - python3 manage.py migrate
  command: python3 -m gunicorn datalake_from_scratch.wsgi
  network:
    port: 8000
    # env: MY_APP_PORT
  # env:
  #   - name: MY_VAR_EXAMPLE
  #     value: "example"
  # secrets:
  #   - name: my-secret
  #     value-from: "arn:aws:secretsmanager:us-east-1:123456789012:secret:testingstackAppRunnerConstr-kJFXde2ULKbT-S7t8xR:username::"
  #   - name: my-parameter
  #     value-from: "arn:aws:ssm:us-east-1:123456789012:parameter/parameter-name"
  #   - name: my-parameter-only-name
  #     value-from: "parameter-name"
